DELETE FROM MESSAGES;
DELETE FROM TCHATS;
DELETE FROM AIMER_PAGE;
DELETE FROM AIMER_PUBLICATION;
DELETE FROM REUNIR;
DELETE FROM GROUPES;
DELETE FROM RELIER;
DELETE FROM LIENS;
DELETE FROM PUBLICATIONS;
DELETE FROM PAGES;
DELETE FROM UTILISATEURS;

INSERT INTO UTILISATEURS VALUES('USER1', 'Kirby', '123456', 'Sun', 'Steave', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'France', 'Paris', '01/10/2015', null);
INSERT INTO UTILISATEURS VALUES('USER2', 'MarioVert', '123456', 'Mohammad', 'Harris', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Japon', 'Tokyo', '01/10/2016', null);
INSERT INTO UTILISATEURS VALUES('USER3', 'MarioJaune', '123456', 'Zhou', 'Clement', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'France', 'Paris', '01/10/2017', null);
INSERT INTO UTILISATEURS VALUES('USER4', 'LuigiBleu', '123456', 'Jiang', 'Alexis', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Italie', 'Venise', '01/10/2018', null);
INSERT INTO UTILISATEURS VALUES('USER5', 'PommeDeTerre123', '123456', 'Jean', 'Gerard', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'Canada', 'Montreal', '01/10/2014', null);
INSERT INTO UTILISATEURS VALUES('USER6', 'Oignon93', '123456', 'Dupont', 'Pierre', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'Australie', 'Sydney', '01/10/2019', null);
INSERT INTO UTILISATEURS VALUES('USER7', 'Citron123', '123456', 'Dupont', 'Clement', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Bresil', 'Brasilia', '01/10/2001', null);
INSERT INTO UTILISATEURS VALUES('USER8', 'Carotte123', '123456', 'Dupont', 'Jean', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Bresil', 'Rio de Janeiro', '01/10/2000', null);
INSERT INTO UTILISATEURS VALUES('USER9', 'HarryPotter', '123456', 'Zhou', 'Jean', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'Bresil', 'Rio de Janeiro', '01/10/2019', null);
INSERT INTO UTILISATEURS VALUES('USER10', 'Kevin69', '123456', 'Ping', 'Pong', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'France', 'Marseille', '01/10/2019', null);

INSERT INTO UTILISATEURS VALUES('USER11', 'Jean93', '123456', 'Jean', 'Alexandre', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Angleterre', 'Manchester', '01/10/2019', null);
INSERT INTO UTILISATEURS VALUES('USER12', 'HugoBoss75', '123456', 'Jean', 'Pog', 'azerty@gmail.com', '0123456789', '01/01/1970', 'F', 'Angleterre', 'Londres', '01/10/2019', null);
INSERT INTO UTILISATEURS VALUES('USER13', 'Yoshi123', '123456', 'Ping', 'Julien', 'azerty@gmail.com', '0123456789', '01/01/1970', 'M', 'Angleterre', 'Londres', '01/10/2019', null);



INSERT INTO PAGES VALUES('PAGE1', 'USER1', 'Publique');
INSERT INTO PAGES VALUES('PAGE2', 'USER2', 'Publique');
INSERT INTO PAGES VALUES('PAGE3', 'USER3', 'Publique');
INSERT INTO PAGES VALUES('PAGE4', 'USER4', 'Publique');
INSERT INTO PAGES VALUES('PAGE5', 'USER5', 'Privée');
INSERT INTO PAGES VALUES('PAGE6', 'USER6', 'Publique');
INSERT INTO PAGES VALUES('PAGE7', 'USER7', 'Privée');
INSERT INTO PAGES VALUES('PAGE8', 'USER8', 'Publique');
INSERT INTO PAGES VALUES('PAGE9', 'USER9', 'Publique');
INSERT INTO PAGES VALUES('PAGE10', 'USER9', 'Privée');
INSERT INTO PAGES VALUES('PAGE11', 'USER10', 'Privée');

INSERT INTO PAGES VALUES('PAGE12', 'USER11', 'Publique');
INSERT INTO PAGES VALUES('PAGE13', 'USER12', 'Publique');
INSERT INTO PAGES VALUES('PAGE14', 'USER13', 'Publique');

INSERT INTO PAGES VALUES('PAGE_GRP_1', 'USER1', 'Publique');
INSERT INTO PAGES VALUES('PAGE_GRP_2', 'USER1', 'Publique');
INSERT INTO PAGES VALUES('PAGE_GRP_3', 'USER2', 'Publique');




INSERT INTO PUBLICATIONS VALUES('PUB1','PAGE1', 'Facebook', '01/10/2019', 'Facebook recupère nos données !!! Facebook recupère nos données !!! Facebook recupère nos données !!! ', 6, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB2','PAGE1', 'Google', '01/10/2019', 'Google recupère nos données, by Trump Trump Trump Trump Trump Trump Trump Trump Trump', 8, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB3','PAGE1', 'Snapchat', '02/10/2019', 'Snapchat recupère nos données, by Trump', 7, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB4','PAGE1', 'Instagram', '02/10/2019', 'Instagram recupère données, by Trump Trump', 1, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB5','PAGE2', 'Mariage', '02/10/2019', 'Trump !', 6, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB6','PAGE3', 'BBD', '03/10/2019', 'Premier cours : Mise a niveau', 6, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB7','PAGE4', 'Président Américain', '03/10/2019', 'Obama de retour !', 6, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB8','PAGE5', 'Partiel', '03/10/2019', 'Ramenez vos stylos', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB9','PAGE6', 'CAC40', '04/10/2019', 'Baisse du CAC40', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB10','PAGE7', 'Vert ou Bleu', '05/10/2019', 'Couleur de cette image', 2, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB11','PAGE8', 'Recette de soupe', '05/10/2019', 'Potiron + creme', 8, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB12','PAGE9', 'Nanorobot', '05/10/2019', 'Fin de l humanité !!! Fin de l humanité !!! Fin de l humanité !!! Fin de l humanité !!! Fin de l humanité !!! ', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB13','PAGE10', 'Mario Kart', '05/10/2019', 'Jeu de retour sur nos smartphone, by Trump', 6, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB14','PAGE11', 'Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, NULL);

INSERT INTO PUBLICATIONS VALUES('PUB15','PAGE12', 'Brico', '06/10/2019', 'Planter une vis dans un plancher', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB16','PAGE13', 'Poisson', '07/10/2019', 'Saumon, Thon, Sardine, Goujon', 1, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB17','PAGE14', 'Black Friday', '07/10/2019', 'EVENT : 27 Novembre, ATTENTION !!!, by Trump', 2, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB18','PAGE14', 'White Friday', '07/10/2019', 'EVENT : 27 Novembre, ATTENTION !!!', 0, NULL);

INSERT INTO PUBLICATIONS VALUES('PUB_GRP_1', 'PUB_GRP_1', 'PARTIEL : Lundi', '06/10/2019', 'Economie', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB_GRP_2', 'PUB_GRP_2', 'PARTIEL : Mardi', '07/10/2019', 'Maths', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('PUB_GRP_3', 'PUB_GRP_3', 'PARTIEL : Mercredi', '07/10/2019', 'BDD', 0, NULL);

INSERT INTO PUBLICATIONS VALUES('Q6_PUB1','PAGE1', 'Facebook', '01/10/2019', 'Facebook', 112, NULL);
INSERT INTO PUBLICATIONS VALUES('Q6_PUB2','PAGE1', 'Google', '01/10/2019', 'Google', 101, NULL);
INSERT INTO PUBLICATIONS VALUES('Q6_PUB3','PAGE1', 'Google', '01/10/2019', 'Google', 50, NULL);

INSERT INTO PUBLICATIONS VALUES('R_PUB2', 'PAGE11', 'Re : Mariage', '06/10/2019', 'Fourchette', 0, 'PUB5');
INSERT INTO PUBLICATIONS VALUES('R_PUB3', 'PAGE11', 'Re : Premier cours : Mise a niveau', '06/10/2019', 'Maths', 0, 'PUB6');
INSERT INTO PUBLICATIONS VALUES('R_PUB4', 'PAGE11', 'Re : Obama de retour !', '06/10/2019', 'Yess we can !', 0, 'PUB7');

INSERT INTO PUBLICATIONS VALUES('R_PUB5', 'PAGE12', 'Re : Premier cours : Mise a niveau','06/10/2019',  'BDD', 0, 'PUB6');
INSERT INTO PUBLICATIONS VALUES('R_PUB6', 'PAGE12', 'Re : Obama de retour !', '07/10/2019', 'Yess we can !!!', 0, 'PUB7');

INSERT INTO PUBLICATIONS VALUES('R_PUB7', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'PUB5');
INSERT INTO PUBLICATIONS VALUES('R_PUB8', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'PUB6');
INSERT INTO PUBLICATIONS VALUES('R_PUB9', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'PUB7');
INSERT INTO PUBLICATIONS VALUES('R_PUB10', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'R_PUB2');
INSERT INTO PUBLICATIONS VALUES('R_PUB11', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'R_PUB3');
INSERT INTO PUBLICATIONS VALUES('R_PUB12', 'PAGE1', 'Re : Google recupère nos données, by Trump', '06/10/2019', 'Economie', 0, 'R_PUB4');



INSERT INTO LIENS VALUES('LIEN1', 'Ami', 'USER10', '01/10/2019');
INSERT INTO LIENS VALUES('LIEN2', 'Ami', 'USER2', '02/10/2019');
INSERT INTO LIENS VALUES('LIEN3', 'Ami', 'USER3', '03/10/2019');
INSERT INTO LIENS VALUES('LIEN4', 'Ami', 'USER4', '04/11/2019');
INSERT INTO LIENS VALUES('LIEN5', 'Ami', 'USER11', '05/11/2019');

INSERT INTO LIENS VALUES('LIEN6', 'Ami', 'USER2', '06/10/2019');
INSERT INTO LIENS VALUES('LIEN7', 'Ami', 'USER3', '07/11/2019');
INSERT INTO LIENS VALUES('LIEN8', 'Ami', 'USER4', '08/11/2019');



INSERT INTO RELIER VALUES('USER1', 'LIEN1');
INSERT INTO RELIER VALUES('USER1', 'LIEN2');
INSERT INTO RELIER VALUES('USER1', 'LIEN3');
INSERT INTO RELIER VALUES('USER1', 'LIEN4');
INSERT INTO RELIER VALUES('USER1', 'LIEN5');
INSERT INTO RELIER VALUES('USER2', 'LIEN3');
INSERT INTO RELIER VALUES('USER4', 'LIEN1');
INSERT INTO RELIER VALUES('USER10', 'LIEN2');
INSERT INTO RELIER VALUES('USER10', 'LIEN3');
INSERT INTO RELIER VALUES('USER10', 'LIEN4');
INSERT INTO RELIER VALUES('USER11', 'LIEN3');
INSERT INTO RELIER VALUES('USER12', 'LIEN6');
INSERT INTO RELIER VALUES('USER13', 'LIEN7');
INSERT INTO RELIER VALUES('USER13', 'LIEN8');



INSERT INTO GROUPES VALUES('GRP1', 'MasterPower', 'PAGE_GRP_1');
INSERT INTO GROUPES VALUES('GRP2', 'Flat Earth Society', 'PAGE_GRP_2');
INSERT INTO GROUPES VALUES('GRP3', 'Erasmus', 'PAGE_GRP_3');



INSERT INTO REUNIR VALUES('GRP1', 'USER1');
INSERT INTO REUNIR VALUES('GRP1', 'USER2');
INSERT INTO REUNIR VALUES('GRP1', 'USER3');
INSERT INTO REUNIR VALUES('GRP1', 'USER4');
INSERT INTO REUNIR VALUES('GRP1', 'USER5');
INSERT INTO REUNIR VALUES('GRP1', 'USER6');
INSERT INTO REUNIR VALUES('GRP1', 'USER9');
INSERT INTO REUNIR VALUES('GRP1', 'USER11');

INSERT INTO REUNIR VALUES('GRP2', 'USER1');
INSERT INTO REUNIR VALUES('GRP2', 'USER2');
INSERT INTO REUNIR VALUES('GRP2', 'USER3');
INSERT INTO REUNIR VALUES('GRP2', 'USER4');
INSERT INTO REUNIR VALUES('GRP2', 'USER10');
INSERT INTO REUNIR VALUES('GRP2', 'USER11');

INSERT INTO REUNIR VALUES('GRP3', 'USER7');
INSERT INTO REUNIR VALUES('GRP3', 'USER8');
INSERT INTO REUNIR VALUES('GRP3', 'USER9');
INSERT INTO REUNIR VALUES('GRP3', 'USER10');
INSERT INTO REUNIR VALUES('GRP3', 'USER11');
INSERT INTO REUNIR VALUES('GRP3', 'USER12');
INSERT INTO REUNIR VALUES('GRP3', 'USER13');



INSERT INTO AIMER_PAGE VALUES('USER1', 'PAGE1');
INSERT INTO AIMER_PAGE VALUES('USER1', 'PAGE2');
INSERT INTO AIMER_PAGE VALUES('USER1', 'PAGE3');
INSERT INTO AIMER_PAGE VALUES('USER1', 'PAGE4');
INSERT INTO AIMER_PAGE VALUES('USER1', 'PAGE6');

INSERT INTO AIMER_PAGE VALUES('USER2', 'PAGE1');
INSERT INTO AIMER_PAGE VALUES('USER2', 'PAGE2');
INSERT INTO AIMER_PAGE VALUES('USER2', 'PAGE3');
INSERT INTO AIMER_PAGE VALUES('USER2', 'PAGE4');
INSERT INTO AIMER_PAGE VALUES('USER2', 'PAGE6');

INSERT INTO AIMER_PAGE VALUES('USER3', 'PAGE1');
INSERT INTO AIMER_PAGE VALUES('USER3', 'PAGE2');
INSERT INTO AIMER_PAGE VALUES('USER3', 'PAGE3');

INSERT INTO AIMER_PAGE VALUES('USER4', 'PAGE1');
INSERT INTO AIMER_PAGE VALUES('USER4', 'PAGE2');
INSERT INTO AIMER_PAGE VALUES('USER4', 'PAGE3');

INSERT INTO AIMER_PAGE VALUES('USER5', 'PAGE1');
INSERT INTO AIMER_PAGE VALUES('USER5', 'PAGE2');
INSERT INTO AIMER_PAGE VALUES('USER5', 'PAGE3');
INSERT INTO AIMER_PAGE VALUES('USER5', 'PAGE4');
INSERT INTO AIMER_PAGE VALUES('USER5', 'PAGE5');


INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB1');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB4');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB5');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB11');
INSERT INTO AIMER_PUBLICATION VALUES('USER1', 'PUB13');

INSERT INTO AIMER_PUBLICATION VALUES('USER2', 'PUB1');
INSERT INTO AIMER_PUBLICATION VALUES('USER2', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER2', 'PUB10');
INSERT INTO AIMER_PUBLICATION VALUES('USER2', 'PUB13');
INSERT INTO AIMER_PUBLICATION VALUES('USER2', 'PUB14');

INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB1');
INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB11');
INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB13');
INSERT INTO AIMER_PUBLICATION VALUES('USER3', 'PUB17');

INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'PUB6');
INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'PUB14');
INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'R_PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'R_PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER4', 'R_PUB4');

INSERT INTO AIMER_PUBLICATION VALUES('USER5', 'PUB5');
INSERT INTO AIMER_PUBLICATION VALUES('USER5', 'PUB11');

INSERT INTO AIMER_PUBLICATION VALUES('USER6', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER6', 'PUB6');
INSERT INTO AIMER_PUBLICATION VALUES('USER6', 'PUB11');

INSERT INTO AIMER_PUBLICATION VALUES('USER7', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER7', 'PUB7');
INSERT INTO AIMER_PUBLICATION VALUES('USER7', 'PUB11');

INSERT INTO AIMER_PUBLICATION VALUES('USER8', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER8', 'PUB11');

INSERT INTO AIMER_PUBLICATION VALUES('USER9', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER9', 'PUB13');
INSERT INTO AIMER_PUBLICATION VALUES('USER9', 'PUB16');

INSERT INTO AIMER_PUBLICATION VALUES('USER10', 'PUB1');
INSERT INTO AIMER_PUBLICATION VALUES('USER10', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER10', 'PUB17');

INSERT INTO AIMER_PUBLICATION VALUES('USER11', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER11', 'PUB10');
INSERT INTO AIMER_PUBLICATION VALUES('USER11', 'PUB11');
INSERT INTO AIMER_PUBLICATION VALUES('USER11', 'PUB13');

INSERT INTO AIMER_PUBLICATION VALUES('USER12', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER12', 'PUB3');

INSERT INTO AIMER_PUBLICATION VALUES('USER13', 'PUB1');
INSERT INTO AIMER_PUBLICATION VALUES('USER13', 'PUB2');
INSERT INTO AIMER_PUBLICATION VALUES('USER13', 'PUB3');
INSERT INTO AIMER_PUBLICATION VALUES('USER13', 'PUB11');
INSERT INTO AIMER_PUBLICATION VALUES('USER13', 'PUB13');







/*QUESTION 1*/
SELECT * FROM UTILISATEURS;

/*QUESTION 2*/
SELECT COUNT(COUNT(*)) FROM UTILISATEURS GROUP BY PAYS;

/*QUESTION 3*/
SELECT NOM, PRENOM, PAYS FROM UTILISATEURS WHERE PAYS='Bresil' ORDER BY NOM ASC;

/*QUESTION 4*/
SELECT VILLE, COUNT(*) FROM UTILISATEURS WHERE PAYS='France' GROUP BY VILLE;

/*QUESTION 5*/
SELECT COUNT(*) AS COMPTE_CREER FROM UTILISATEURS WHERE DATE_INSC>='01/01/2010' AND DATE_INSC<='31/12/2017';

/*QUESTION 6*/
/*Revoir avec trigger pour chaque insertion UDAPTE NBJAIME dans PUBLICATIONS*/
SELECT * FROM PUBLICATIONS WHERE LENGTH(TEXTE)<100 AND NB_JAIME>100;

/*QUESTION 7*/
SELECT PSEUDO, DATE_LIAISON
    FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS 
    WHERE LIENS='Ami' AND NUM_USER2= (
        SELECT NUM_USER
            FROM UTILISATEURS
            WHERE PSEUDO='Kevin69'
    )
    ORDER BY DATE_LIAISON DESC;

/*QUESTION 8*/
SELECT PSEUDO, COUNT(*) AS NB_AMIS 
    FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS
    WHERE VILLE='Londres' AND LIENS='Ami'
    GROUP BY PSEUDO
    ORDER BY COUNT(*) ASC;

/*QUESTION 9*/
SELECT NOM_GROUPE, COUNT(*) 
    FROM UTILISATEURS NATURAL JOIN REUNIR NATURAL JOIN GROUPES
    GROUP BY NOM_GROUPE 
    ORDER BY COUNT(*) DESC
    FETCH FIRST 1 ROWS ONLY;

/*QUESTION 10*/
/*
    On ne recupere que la premiere ligne dans l'ordre decroissant, donc le tuple affiché, sera le sexe majoritaire du groupe
*/
SELECT SEXE, COUNT(*) 
    FROM UTILISATEURS NATURAL JOIN REUNIR NATURAL JOIN GROUPES
    WHERE NOM_GROUPE='Flat Earth Society'
    GROUP BY SEXE
    ORDER BY COUNT(*) DESC
    FETCH FIRST 1 ROW ONLY;

/*QUESTION 11*/
SELECT NUM_PAGE, AVG(NB_JAIME)
	FROM PUBLICATIONS NATURAL JOIN PAGES
	GROUP BY NUM_PAGE
	HAVING AVG(NB_JAIME)>=5
	ORDER BY AVG(NB_JAIME) DESC;
    
/*QUESTION 12*/
SELECT NUM_PAGE, MAX(NB_JAIME)
	FROM PUBLICATIONS
	GROUP BY NUM_PAGE
	ORDER BY NUM_PAGE;
    
/*QUESTION 13*/
/*
    On va tout d'abord recuperer les utilisateurs qui ont plus de 5 jaimes par publications
    Puis faire une moyenne des notes par (groupes, utilisateurs)
    Par la suite on va compter le nombre de note superieur a 5 dans chaque groupe
    On va associe une colonne en plus, qui sera la colonne des nombre de personnes au totals dans chaque groupe
    Apres avoir associe, on verifie si plus de 50% des membres du groupes ont plus de 5 jaimes en moyenne par publications sur leurs pages
*/

SELECT NUM_GROUPE, NB_NOTEMOY_SUPERIEUR_5, NB_MEMBRE_GRP, (NB_NOTEMOY_SUPERIEUR_5/NB_MEMBRE_GRP*100) AS POURCENTAGE
    FROM (
        SELECT NUM_GROUPE, COUNT(*) AS NB_NOTEMOY_SUPERIEUR_5
            FROM (
                SELECT NUM_GROUPE, NUM_USER, AVG(NB_JAIME)
                    FROM REUNIR NATURAL JOIN UTILISATEURS NATURAL JOIN PAGES NATURAL JOIN PUBLICATIONS
                    GROUP BY NUM_GROUPE, NUM_USER
                    HAVING AVG(NB_JAIME)>5
                    ORDER BY NUM_GROUPE, NUM_USER
            )
            GROUP BY NUM_GROUPE
    ) NATURAL JOIN (
        SELECT NUM_GROUPE, COUNT(*) AS NB_MEMBRE_GRP
            FROM REUNIR
            GROUP BY NUM_GROUPE
    )
    WHERE (NB_NOTEMOY_SUPERIEUR_5 / NB_MEMBRE_GRP) >= 0.5;

/*QUESTION 14*/
/*
    On recupere le nombre de caracteres pour Trump
    On recupere le nombre de caracteres totales 
    On divise puis on multiplie par 100
    Arrondis le calcul au centième
*/
SELECT TEXTE, ROUND((LENGTH(TEXTE) - LENGTH(REPLACE(TEXTE,'Trump',''))) / LENGTH(TEXTE) * 100, 2) AS MOYENNE_MOTS_EN_POURCENTAGE
    FROM PUBLICATIONS
    WHERE TEXTE LIKE '%Trump%';


/*QUESTION 15*/
/*
    Premier bloc avant le NATURAL JOIN
    On recupere les amis de tout le monde
    On recupere les publications de tous le monde, en ayant recuperant les relations fils / pere (PP2.NUM_PUBLICATION=PP1.NUM_PUB_PERE) comme pour les arbres, pour savoir qui a repondu sur toute les publications de ses amis
    
    Deuxieme bloc, on recupere le nombre d'amis de chacun
    On rassemble les deux blocs
    
    Et si le nombre de de publication est identique, alors il a publie sur toute les publications de ses amis
    Generer P2.NUM_PAGE=COUNT(*) de toute ses publications=100%
*/
SELECT *
    FROM (
        SELECT NUM_USER, COUNT(*) AS NB_AMIS_PUBLICATION
            FROM (  
                SELECT NUM_USER, NUM_USER2
                    FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS
                    WHERE LIENS='Ami'
                INTERSECT
                SELECT P1.NUM_USER, P2.NUM_USER
                    FROM PAGES P1 JOIN PUBLICATIONS PP1
                    ON P1.NUM_PAGE=PP1.NUM_PAGE
                    JOIN PUBLICATIONS PP2
                    ON PP2.NUM_PUBLICATION=PP1.NUM_PUB_PERE
                    JOIN PAGES P2
                    ON P2.NUM_PAGE=PP2.NUM_PAGE
            )
            GROUP BY NUM_USER
    )
    NATURAL JOIN 
    (
        SELECT NUM_USER, COUNT(*) AS NB_AMIS_DE_X
            FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS
            WHERE LIENS='Ami'
            GROUP BY NUM_USER
    )
    WHERE NB_AMIS_PUBLICATION=NB_AMIS_DE_X;

/*QUESTION 16*/
/*
    Pareil que la question 15, mais on nutilise plus loperation = mais plutot (POURCENTAGE >= 0.8)
*/
SELECT *
    FROM (
        SELECT NUM_USER, COUNT(*) AS NB_AMIS_PUBLICATION
            FROM (  
                SELECT NUM_USER, NUM_USER2
                    FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS
                    WHERE LIENS='Ami'
                INTERSECT
                SELECT P1.NUM_USER, P2.NUM_USER
                    FROM PAGES P1 JOIN PUBLICATIONS PP1
                    ON P1.NUM_PAGE=PP1.NUM_PAGE
                    JOIN PUBLICATIONS PP2
                    ON PP2.NUM_PUBLICATION=PP1.NUM_PUB_PERE
                    JOIN PAGES P2
                    ON P2.NUM_PAGE=PP2.NUM_PAGE
            )
            GROUP BY NUM_USER
    )
    NATURAL JOIN 
    (
        SELECT NUM_USER, COUNT(*) AS NB_AMIS_DE_X
            FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS
            WHERE LIENS='Ami'
            GROUP BY NUM_USER
    )
    WHERE (NB_AMIS_PUBLICATION/NB_AMIS_DE_X)>=0.8;


/*QUESTION 17*/
/*
    PUB1 : Retrouver les publications de Kevin
    AP2 : Retrouver les publications de Kevin aimé par tous ses amis
    AP1 : On recupere les personnes qui ne sont pas dans AP2, cest a dire les personnes qui ont aime toute les publications de Kevin
    
*/

SELECT DISTINCT NUM_USER
	FROM AIMER_PUBLICATION AP1  
	WHERE NUM_USER IN (SELECT NUM_USER2 FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS WHERE LIENS='Ami' AND PSEUDO='Kevin69')
	AND NOT EXISTS(
		SELECT PUB1.NUM_PUBLICATION     
			FROM UTILISATEURS NATURAL JOIN PAGES NATURAL JOIN PUBLICATIONS PUB1
			WHERE PSEUDO='Kevin69'
			AND NOT EXISTS (
				SELECT NUM_USER, NUM_PUBLICATION     
					FROM AIMER_PUBLICATION AP2   
					WHERE NUM_USER IN (SELECT NUM_USER2 FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS WHERE LIENS='Ami' AND PSEUDO='Kevin69')
					AND AP2.NUM_USER=AP1.NUM_USER
					AND PUB1.NUM_PUBLICATION=AP2.NUM_PUBLICATION
			)
	);

/*QUESTION 18*/
/*
                    Liste des groupes avec ses utilisateurs :
                    SELECT * 
                        FROM REUNIR 
                        ORDER BY NUM_USER;

    R1 : On recupere les groupes de Kevin
    R2 : On recupere les personnes qui ne sont pas dans tous les groupes de Kevin
    R0 : On recupere les personnes qui ne sont pas affiche dans R2, cest a dire les personnes qui sont dans tous les groupes de Kevin
    On peut faire un MINUS pour supprimer le NUM_USER de Kevin
*/
SELECT DISTINCT NUM_USER    
    FROM REUNIR R0
    WHERE NOT EXISTS(
        SELECT R1.NUM_GROUPE, R1.NUM_USER
            FROM REUNIR R1
            WHERE R1.NUM_USER = (SELECT NUM_USER FROM UTILISATEURS WHERE PSEUDO='Kevin69')
            AND NOT EXISTS (
                SELECT R2.NUM_USER, R2.NUM_GROUPE
                    FROM REUNIR R2
                    WHERE R2.NUM_USER=R0.NUM_USER
                    AND R1.NUM_GROUPE=R2.NUM_GROUPE
            )
    );    
    
/*QUESTION 19*/
/*                  
                    Liste des amis :
                    SELECT * 
                        FROM RELIER NATURAL JOIN LIENS
                        WHERE LIENS='Ami';

    L1 : Retrouver les amis de Kevin
    R1 : On recupere les personnes qui nont pas tous les amis de Kevin
    R0 : On recupere les personne qui ne sont pas affiche dans R1, cest a dire les personnes qui ont les meme amis que Kevin
    COUNT(*)-1 car on recupere le NUM_USER de Kevin
*/

SELECT COUNT(DISTINCT NUM_USER)-1 AS AMI_AVEC_TOUS_LES_AMIS_DE_KEVIN
    FROM RELIER R0
    WHERE NOT EXISTS(
        SELECT NUM_USER2
            FROM LIENS L1
            WHERE NUM_LIENS IN ( SELECT NUM_LIENS FROM UTILISATEURS NATURAL JOIN RELIER NATURAL JOIN LIENS WHERE PSEUDO='Kevin69' AND  LIENS='Ami')
            AND NOT EXISTS (
                SELECT * 
                    FROM RELIER R1
                    WHERE R1.NUM_USER=R0.NUM_USER
                    AND L1.NUM_LIENS=R1.NUM_LIENS
            )
    );




INSERT INTO PUBLICATIONS VALUES('TREE_PUB0', 'PAGE4', 'Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'PUB14');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB1', 'PAGE4', 'Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB0');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB2', 'PAGE4', 'Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB1');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB3', 'PAGE4', 'Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB2');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB4', 'PAGE4', 'Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB3');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB5', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB4');

INSERT INTO PUBLICATIONS VALUES('TREE_PUB6', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB5');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB7', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB6');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB8', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB7');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB9', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB8');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB10', 'PAGE4', 'Re : Re : Re : Re : Re : Re : Re : Re : Re : Re : Re : Black Friday', '06/10/2019', '27 Novembre, préparez vos CB !!!', 0, 'TREE_PUB9');

INSERT INTO PUBLICATIONS VALUES('PUB20','PAGE11', 'Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, NULL);
INSERT INTO PUBLICATIONS VALUES('TREE_PUB21','PAGE3', 'Re : Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, 'PUB20');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB22','PAGE3', 'Re : Re : Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, 'TREE_PUB21');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB23','PAGE3', 'Re : Re : Re : Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, 'TREE_PUB22');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB24','PAGE3', 'Re : Re : Re : Re : Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, 'TREE_PUB23');
INSERT INTO PUBLICATIONS VALUES('TREE_PUB25','PAGE3', 'Re : Re : Re : Re : Re : Noel', '01/12/2019', 'Hohoho, soyez sage les enfants !!!', 0, 'TREE_PUB24');

/*QUESTION 20*/
SELECT LEVEL, NUM_PUBLICATION
    FROM PUBLICATIONS
    WHERE LEVEL>10
    START WITH NUM_PUBLICATION=(
        SELECT NUM_PUBLICATION
            FROM UTILISATEURS NATURAL JOIN PAGES NATURAL JOIN PUBLICATIONS
            WHERE PSEUDO='Kevin69'
            ORDER BY NUM_PUBLICATION
            FETCH FIRST 1 ROW ONLY    
    )
    CONNECT BY (NUM_PUB_PERE = PRIOR NUM_PUBLICATION);


/*QUESTION 21*/
SELECT NUM_PUBLICATION, LEVEL, TITRE
    FROM PUBLICATIONS
    START WITH NUM_PUBLICATION IN (
        SELECT NUM_PUBLICATION
            FROM PUBLICATIONS
            WHERE NUM_PUB_PERE IS NULL
    )
    CONNECT BY PRIOR NUM_PUBLICATION=NUM_PUB_PERE
    ORDER BY LEVEL ASC;
                                    
/*QUESTION 22*/        
SELECT (NB_REPONSES / NB_PUBLICATIONS) AS REPONSE_MOYENNE
    FROM (
        SELECT COUNT(*) AS NB_REPONSES
            FROM PUBLICATIONS
            WHERE LEVEL>1
            START WITH NUM_PUBLICATION IN (
                SELECT NUM_PUBLICATION
                    FROM PUBLICATIONS NATURAL JOIN PAGES
                    WHERE NUM_PUB_PERE IS NULL
                    AND NUM_USER IN (SELECT NUM_USER FROM UTILISATEURS WHERE PSEUDO='Kevin69')
            )
            CONNECT BY PRIOR NUM_PUBLICATION=NUM_PUB_PERE
    )
    NATURAL JOIN 
    (
        SELECT COUNT(*) AS NB_PUBLICATIONS
            FROM PUBLICATIONS NATURAL JOIN PAGES
            WHERE NUM_PUB_PERE IS NULL
            AND NUM_USER IN (SELECT NUM_USER FROM UTILISATEURS WHERE PSEUDO='Kevin69')
    );

/*QUESTION 23*/

SELECT DISTINCT PSEUDO
    FROM PUBLICATIONS NATURAL JOIN PAGES NATURAL JOIN UTILISATEURS
    WHERE LEVEL>3
    START WITH NUM_PUBLICATION IN (
        SELECT NUM_PUBLICATION
            FROM PUBLICATIONS
            WHERE NUM_PUB_PERE IS NULL
    )
    CONNECT BY PRIOR NUM_PUBLICATION=NUM_PUB_PERE;

















